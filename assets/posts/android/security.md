# How Android and apps are secured?

Android is bases on Linux kernel. Both Android and Linux are open source projects. So any one can find a security vulnerability just looking at the source code. Most of the operating systems are customized by some vendors but even with that it not 100% sure that all the security features are in place.Android have some of the features to make more secure platform by making the security implementation on 3 levels.

- Kernel level
- Application level
- Communication level

## Kernel level security

Linux kernel have some security build on it. So we have out of the box security from base kernel. Apart from that Android OS base operating system development team adding new patches to the customized kernel.OS features like user based permission model,process isolation and secure inter process communication (IPC) allows applications to run without having to use implement those from ground.

## Application level security

Each application we run get an "Application Sandbox" of its own. The help the application to run in isolation and let other applications not to tamper with the data.Each app has its own unique user ID.Each application run in the separate process from kernel level.

There are file system permission witch kind have the same behavior. Unless the application developer explicitly share application files (files generated by the application,not the files used to develop and run) they have limited access.

When developing application we need to think about to make sure the application to follow the best practice.

### Make sure we only ask fro the right permission we need

Application developer should be mind enough to define the permission its only need. Some permission are not need to application that will make the user suspicious about the application. For example we can assume a simple Flashlight application will not use your Galley information. If you do give a good reason for the user explaining why. Even we define some application permission at manifest level,some applications permissions are asked at run time,example make a phone call. So keep in mind that user can allow it or not. Handle both situations or your app might crash.

### Store application data securely

You can store application level data on Key Store to make them more secure. But sometime we need more more protection other than that. We should be using internal storage,witch is Sandbox per app. Also we might need to save the private or sensitive information with **_EncriptedFile_** (more on this later).

We can also use the external storage to use but make sure you can access,needed storage is available and ready. We can also use the app level external storage if we like so other apps have no access to it. Make sure to use this storage wisely because its most expose to other applications.

Some application will use the build in SQLite database to store data. Developer must pay attention to the SQL queries that we use is not vulnerable to SQL injection attacks. Try to use the ORM like Room to reduce risk but that that does not state your 100% safe. So you have to make sure you test queries

### App singing

Application need to be digitally sign before they are distributed to make sure the the app is distributed by the correct developer and the the App store (like Google play store) verify that is the user is legitimate when distributing.

Make sure to follow the application [security check list](https://developer.android.com/distribute/essentials/quality/core#sc) before you publish app.

## Communication level security

App can communicate with other apps or with web application(REST API or any other service). We can secure each of these types using android build in features or industry level standards available.

Let take the scenario where we have to share information with an other application using an intent. We can have an application that is capable of handling that if there is only one application that can handle that is install in the phone you can start that. But if we have more than one choice then we should show a application chooser to use to select the most trusted application they like and pass the data.

```kotlin
val intent = Intent(ACTION_SEND)
val possibleActivitiesList: List<ResolveInfo> =
        queryIntentActivities(intent, PackageManager.MATCH_ALL)

if (possibleActivitiesList.size > 1) {
    val chooser = resources.getString(R.string.chooser_title).let { title ->
        Intent.createChooser(intent, title)
    }
    startActivity(chooser)
} else if (intent.resolveActivity(packageManager) != null) {
    startActivity(intent)
}
```

Also we have to make sure other application can't access your data via **_ContentProviders_**. This way you can secure your applications data from other applications. If you develop an application witch target less than API level 16 you can use the following to disable this.

```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.example.myapp">
    <application ... >
        <provider
            android:name="android.support.v4.content.FileProvider"
            android:authorities="com.example.myapp.fileprovider"
            ...
            android:exported="false">
            <!-- Place child elements of <provider> here. -->
        </provider>
        ...
    </application>
</manifest>
```

When we communicate with outside world via network,make sure we use secure chanel, like HTTPS. Its best practice to have a security configuration on the application when we try communicate non secure chanel. For example when we try to connect to an REST API witch is running in a local network and you have no HTTPS over it you need to define this property to in oder to prevent this issue. Other case might be your using an custom Certificate Authority (CA) then you have to register it in your application.

1. In application manifest

```xml
<manifest ... >
    <application
        android:networkSecurityConfig="@xml/network_security_config"
        ... >
        <!-- Place child elements of <application> element here. -->
    </application>
</manifest>
```

2. in **_res/xml/network_security_config.xml._**

```xml
<?xml version="1.0" encoding="utf-8"?>
<network-security-config>
    <domain-config cleartextTrafficPermitted="true">
        <domain includeSubdomains="true">192.168.1.3</domain>
    </domain-config>
</network-security-config>
```

# AndroidX Libraries

With some new libraries from Android we have great support for security improvement for our application. We can use the new **_BiometricPrompt_** to check for the user authentication. There were some old API now unified under AndroidX.
